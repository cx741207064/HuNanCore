/**
 * Created by Li Hongwei on 2015-05-30.
 */
"use strict";
;(function(c,b,a,d){c.Rest=function(f){var g=null;var i=this;var h=true;var e=function(n,m,l){var j="",k;while(n.length>0){k=n.match(m);if(k){j+=n.slice(0,k.index);j+=l(k).toString();n=n.slice(k.index+k[0].length)}else{j+=n;n=""}}return j};this.setOptions=function(j){g=j;return this};this.getOptions=function(){return g};this.isEmpty=function(j){return(j==null||j==""||j==d||j=="null")};this.checkLogin=function(k,j,l){if(isEmpty(store.get("tokenid"))||j){if(k){parent.location.href=PROJECT_URL+"login.html"}else{if(parent.$("#login-main").is(":hidden")){parent.getImage();parent.$("#login_mask").show();parent.$("#login-main").show()}}return false}return true};this.setRefresh=function(j){h=j||true};this.getRefresh=function(){return h};this.buildUrl=function(l,k){var n=c.extend(true,{},k);var m=[];var j=!l?"":e(l,/\{(.+?)\}/,function(o){var p=o[1];var q=n[p];if(q===d||q===null){c.error("Can't found '"+p+"' from urlParams.")}m.push(p);return encodeURIComponent(q)});return j};this.buildResult=function(o,j){var m=this;j=c.extend(true,{},c.Rest.options.defaults,j);var l=j.success;var k=j.error;if(j.serializeRequestBody){try{j.data=j.serializeRequestBody(j)}catch(n){c.error("序列化失败. "+n.message)}}j.success=function(q,s,p){if(q.rescode=="100000010004"||q.rescode=="100000010005"){return m.checkLogin(j.isJump,true)}else{if(j.deserializeResponseBody){try{q=j.deserializeResponseBody(q,j)}catch(r){c.error("发序列化失败. "+r.message)}}if(l){l(q,s,p)}}};j.error=function(q,s,r){var p;if(j.deserializeError){p=j.deserializeError(q,s,r,j)}else{p=(q&&q.responseText)||r||s}if(k){k(p,q,s,r)}};j.url=this.buildUrl(j.url,j.urlParams);if(g.baseUrl){j.url=g.baseUrl+j.url}j.type=o;return j};this.send=function(m,j){try{var k=this.buildResult(m,j);if(k.data){if(JSON.stringify(k.data).indexOf("tokenid")>-1){if(k.openPanel){if(!store.get("tokenid")){this.checkLogin(k.isJump);return false}}}}return c.ajax(k)}catch(l){c.error(l.message)}};this.get=function(j){return this.send("GET",j)};this.post=function(j){return this.send("POST",j)};this.put=function(j){return this.send("PUT",j)};this.del=function(j){return this.send("DELETE",j)};this.setOptions(f||c.Rest.options.defaults)};c.Rest.options={};c.Rest.options.defaults={baseUrl:null,isJump:false,openPanel:true,dataType:"json",contentType:"application/json",headers:{accept:"application/json"},serializeRequestBody:function(e){if(JSON&&JSON.stringify){return JSON.stringify(e.data)}else{if(c.toJSON){return c.toJSON(e.data)}}throw new Error("需要序列化")},deserializeResponseBody:null,deserializeError:null,error:function(f,e,h,g){}};c.rest=new c.Rest()})(jQuery,window,document);
